<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Node Scripting - Emil Olofsson - Portfolio</title><meta name="description" content="Summary This page contains an overview of a node scripting system I&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://broremilolofsson.github.io/visual-scripting.html"><link rel="alternate" type="application/atom+xml" href="https://broremilolofsson.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://broremilolofsson.github.io/feed.json"><meta property="og:title" content="Node Scripting"><meta property="og:image" content="https://broremilolofsson.github.io/media/posts/4/Skaermbild-2024-04-03-121314.png"><meta property="og:image:width" content="1572"><meta property="og:image:height" content="753"><meta property="og:site_name" content="Emil Olofsson - Portfolio"><meta property="og:description" content="Summary This page contains an overview of a node scripting system I&hellip;"><meta property="og:url" content="https://broremilolofsson.github.io/visual-scripting.html"><meta property="og:type" content="article"><link rel="preload" href="https://broremilolofsson.github.io/assets/dynamic/fonts/publicsans/publicsans.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://broremilolofsson.github.io/assets/css/style.css?v=3bde625adf100598a26c3dc67cfe1125"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://broremilolofsson.github.io/visual-scripting.html"},"headline":"Node Scripting","datePublished":"2024-02-21T12:17","dateModified":"2024-04-08T13:49","image":{"@type":"ImageObject","url":"https://broremilolofsson.github.io/media/posts/4/Skaermbild-2024-04-03-121314.png","height":753,"width":1572},"description":"Summary This page contains an overview of a node scripting system I&hellip;","author":{"@type":"Person","name":"Emil Olofsson","url":"https://broremilolofsson.github.io/authors/emil-olofsson/"},"publisher":{"@type":"Organization","name":"Emil Olofsson","logo":{"@type":"ImageObject","url":"https://broremilolofsson.github.io/media/website/WebsiteLogo.jpg","height":612,"width":612}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body><div class="content"><div class="left-bar"><div class="left-bar__inner"><header class="header"><a class="logo" href="https://broremilolofsson.github.io/"><img src="https://broremilolofsson.github.io/media/website/WebsiteLogo.jpg" alt="Emil Olofsson - Portfolio" width="612" height="612"></a><nav class="navbar"><button class="navbar__toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle__box"><span class="navbar__toggle__inner">Menu</span></span></button><ul class="navbar__menu"><li class="active"><a href="https://broremilolofsson.github.io/visual-scripting.html" target="_self" aria-label="Node Scripting"><span>Node Scripting</span></a></li><li><a href="https://broremilolofsson.github.io/the-negotiators.html" target="_self" aria-label="Project: The Negotiators"><span>Project: The Negotiators</span></a></li><li><a href="https://broremilolofsson.github.io/spite-new-sun.html" target="_self" aria-label="Project: Spite: New Sun"><span>Project: Spite: New Sun</span></a></li><li><a href="https://broremilolofsson.github.io/projects.html" target="_self" aria-label="Project: Stella&#x27;s Quest"><span>Project: Stella&#x27;s Quest</span></a></li><li><a href="https://broremilolofsson.github.io/other-projects.html" target="_self" aria-label="Other Projects"><span>Other Projects</span></a></li><li><a href="https://broremilolofsson.github.io/about-me.html" target="_self" aria-label="About Me"><span>About Me</span></a></li></ul></nav><a class="logo logo--atbottom" href="./"><img src="https://broremilolofsson.github.io/media/website/WebsiteLogo.jpg" alt="Emil Olofsson - Portfolio" width="612" height="612"></a></header></div></div><main class="main"><article class="post"><figure class="post__featured-image post__featured-image--attop"><img src="https://broremilolofsson.github.io/media/posts/4/Skaermbild-2024-04-03-121314.png" srcset="https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-03-121314-xs.png 320w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-03-121314-sm.png 480w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-03-121314-md.png 768w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-03-121314-xl.png 1024w" sizes="(min-width: 1460px) 938px, (min-width: 1200px) calc(75.83vw - 154px), (min-width: 1120px) 938px, (min-width: 900px) calc(55vw + 333px), 100vw" loading="eager" height="753" width="1572" alt="" aria-describedby="image-caption"></figure><div class="main__inner"><header class="post__header"><h1 class="post__title">Node Scripting</h1></header><div class="post__entry"><h3 id="summary">Summary</h3><p>This page contains an overview of a node scripting system I have created. From a level design perspective the system supports:</p><ul><li>Custom Events</li><li>Variables</li><li>Command Tracking / Undo + Redo functionality<br></li></ul><p>From a programmer's perspective the system supports:</p><ul><li>Function based nodes</li><li>Custom data type handling</li></ul><h3 id="background">Background</h3><p>Implementing a modular gameplay system is something that has intrigued me since the start of the <a href="https://broremilolofsson.github.io/projects.html" target="_blank">Stella's Quest</a> project. Since all of my previous systems have been inheritance based, I wanted to try to create something that didn't use classes and virtual functions to enable different behaviors.</p><h3 id="programming-interface">Programming Interface</h3><p>The most important part of creating systems and APIs, in my experience, is the interface to the user. The interface should be simple and effective, both for programmers, when implementing new nodes, and for level designers, when creating the actual game logic visually.</p><p>An intuitive approach to creating nodes involves defining node types through functions. This method allows programmers to easily define functions that have specific behaviors, and then register them to a manager responsible for converting these functions into node types. In this model, the parameters of a function serve as the node's input, while its return values serve as the node's output.</p><figure class="post__image post__image--center"><img loading="lazy" src="https://broremilolofsson.github.io/media/posts/4/Skaermbild-2024-03-28-122602.png" height="187" width="542" alt="" sizes="(min-width: 760px) 660px, calc(93.18vw - 30px)" srcset="https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-03-28-122602-xs.png 320w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-03-28-122602-sm.png 480w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-03-28-122602-md.png 768w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-03-28-122602-xl.png 1024w"><figcaption>Registering a node to the system</figcaption></figure><figure class="post__image post__image--center"><img loading="lazy" src="https://broremilolofsson.github.io/media/posts/4/Skaermbild-2024-03-28-122930.png" height="262" width="372" alt="" sizes="(min-width: 760px) 660px, calc(93.18vw - 30px)" srcset="https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-03-28-122930-xs.png 320w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-03-28-122930-sm.png 480w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-03-28-122930-md.png 768w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-03-28-122930-xl.png 1024w"><figcaption>The generated visual representation of the node</figcaption></figure><p>Since a function in most languages, C++ included, only allows one return value, the container std::tuple was utilized to enable functions to return multiple values in a single data structure.</p><h3 id="execution">Execution</h3><p>The execution part of the code uses a type called <strong>Flow </strong>that acts as the control flow of the program. We can check in compile time if a node has a Flow output, and if that's the case we trigger the connected node to the flow pin.</p><p>When executing a node, the program does the following:</p><ol><li>Retrieves the input data of the node</li><li>Calls the function and retrieves its output data</li><li>Set the output data of the node</li></ol><h3 id="memory-management">Memory Management</h3><p>As we need to be able to allocate essentially any data type in our system, we need to use a data structure that supports this flexibility. The <strong>Memory Pool</strong> enables us to store various data types in contiguous memory. In essence, it is implemented as a vector but without the type safety.</p><figure class="post__image post__image--center"><img loading="lazy" src="https://broremilolofsson.github.io/media/posts/4/Skaermbild-2024-04-02-091513.png" height="301" width="513" alt="" sizes="(min-width: 760px) 660px, calc(93.18vw - 30px)" srcset="https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-091513-xs.png 320w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-091513-sm.png 480w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-091513-md.png 768w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-091513-xl.png 1024w"><figcaption>Example usage of a memory pool</figcaption></figure><p>In the above image, we allocate different types to the memory pool. When allocating a variable to the memory pool, the user receives an ID they can use to access the data. This is opposed to receiving a pointer to the data as we need the memory pool to be relocatable and if we have a pointer to the data, the pointer will have a chance of going out of scope if the memory pool reallocates.</p><p>The memory pool realizes when it is out of memory and reallocates its memory internally, while simultaneously increasing it's size, just like a vector.</p><p>When creating a node, the input/output pins allocate memory in the memory pool and keep the ID stored for usage when the needing to access the data when the node is executed.</p><h3 id="type-erasure">Type Erasure</h3><p>As the execution part is all templated and set at compile time, the program knows how to handle the data types that the node functions use. The problem is when we want to visualize, save and load different data types; How can the user register custom data types that the system handles polymorphically?</p><p>To be able to handle various data types, including custom data types that the user wants, I used a technique called type erasure. The system is essentially type agnostic, meaning it doesn't know or care about the types that it uses.</p><figure class="post__image post__image--center"><img loading="lazy" src="https://broremilolofsson.github.io/media/posts/4/Skaermbild-2024-04-02-102040.png" height="242" width="447" alt="" sizes="(min-width: 760px) 660px, calc(93.18vw - 30px)" srcset="https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-102040-xs.png 320w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-102040-sm.png 480w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-102040-md.png 768w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-102040-xl.png 1024w"><figcaption>Overloaded functions for the "int" type</figcaption></figure><figure class="post__image post__image--center"><img loading="lazy" src="https://broremilolofsson.github.io/media/posts/4/Skaermbild-2024-04-02-105308.png" height="92" width="509" alt="" sizes="(min-width: 760px) 660px, calc(93.18vw - 30px)" srcset="https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-105308-xs.png 320w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-105308-sm.png 480w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-105308-md.png 768w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-105308-xl.png 1024w"><figcaption>Registering of the type "int"</figcaption></figure><p>For example, when implementing a custom data type, the type needs the overloaded functions "Edit", "Save" and "Load". When registering the type, the system itself figures out which overloaded function to call in compile time.</p><figure class="post__image post__image--center"><img loading="lazy" src="https://broremilolofsson.github.io/media/posts/4/Skaermbild-2024-04-02-112540.png" height="184" width="436" alt="" sizes="(min-width: 760px) 660px, calc(93.18vw - 30px)" srcset="https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-112540-xs.png 320w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-112540-sm.png 480w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-112540-md.png 768w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-112540-xl.png 1024w"><figcaption>Type erasure of the edit functionality</figcaption></figure><p>When registering a type, we can create a type erased interface that allows us to perform functionality on data without knowing which type they are. As seen in the above image, the function pointer that is returned from the function is completely type erased, meaning when using it, we don't know which type we are editing. The function signature is type erased while the implementation is not, this is the key to type erasure.</p><figure class="post__image post__image--center"><img loading="lazy" src="https://broremilolofsson.github.io/media/posts/4/Skaermbild-2024-04-02-113450.png" height="146" width="338" alt="" sizes="(min-width: 760px) 660px, calc(93.18vw - 30px)" srcset="https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-113450-xs.png 320w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-113450-sm.png 480w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-113450-md.png 768w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-113450-xl.png 1024w"><figcaption>Type erased interface that is generated for every registered type</figcaption></figure><p>When calling the edit function for a type, you still need some type of identifier to know which type we are dealing with. The thing that the data is bound to, for example a <strong>pin</strong>, can store a <strong>DataTypeID </strong>to remember the underlying data type.</p><figure class="post__image post__image--center"><img loading="lazy" src="https://broremilolofsson.github.io/media/posts/4/Skaermbild-2024-04-02-120505.png" height="189" width="519" alt="" sizes="(min-width: 760px) 660px, calc(93.18vw - 30px)" srcset="https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-120505-xs.png 320w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-120505-sm.png 480w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-120505-md.png 768w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-120505-xl.png 1024w"><figcaption>The function that is called from the editor when wanting to edit/visualize a pin's data</figcaption></figure><p>When we have the <strong>DataTypeID </strong>and the pointer to the data, we can call the edit function of our type. The <strong>DataTypeManager </strong>has a map with the <strong>DataTypeID </strong>as the key and the type erased object as the value. This way we can select the correct function to call.</p><p>One thing to note is that the <strong>DataTypeID </strong>of a type has to be unique for that type. If we have a hash collision, the system will assert.</p><h3 id="custom-event-nodes">Custom Event Nodes</h3><p>Type erasure not only allows us to have polymorphic behavior with types, it enables runtime generation of nodes with customized pins.</p><p>Custom event nodes, inspired by those found in Unreal Engine, are implemented in my system.&nbsp;The user can call the event at any time in the graph using a "caller node" and the functionality attached to the "executor node" will be executed.</p><figure class="post__image post__image--center"><img loading="lazy" src="https://broremilolofsson.github.io/media/posts/4/Skaermbild-2024-04-02-144358.png" height="188" width="482" alt="" sizes="(min-width: 760px) 660px, calc(93.18vw - 30px)" srcset="https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-144358-xs.png 320w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-144358-sm.png 480w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-144358-md.png 768w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-144358-xl.png 1024w"><figcaption>The editor view of creating custom event nodes</figcaption></figure><p>In the editor, the user can create custom event nodes with attached data types. This allows output of the custom event to be flexible depending on who the caller is.</p><figure class="post__image post__image--center"><img loading="lazy" src="https://broremilolofsson.github.io/media/posts/4/Skaermbild-2024-04-02-144404.png" height="339" width="331" alt="" sizes="(min-width: 760px) 660px, calc(93.18vw - 30px)" srcset="https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-144404-xs.png 320w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-144404-sm.png 480w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-144404-md.png 768w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-144404-xl.png 1024w"><figcaption>The "caller" and the "executor" nodes of a custom event</figcaption></figure><h3 id="variables">Variables</h3><p>Similar to Unreal Engine, the system also accommodates variables. This allows users to store and manipulate variables using getter and setter nodes. This functionality creates dynamic scripting capabilities, enabling runtime modifications to the inputs utilized during execution.<br></p><figure class="post__image post__image--center"><img loading="lazy" src="https://broremilolofsson.github.io/media/posts/4/Skaermbild-2024-04-02-151057.png" height="159" width="512" alt="" sizes="(min-width: 760px) 660px, calc(93.18vw - 30px)" srcset="https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-151057-xs.png 320w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-151057-sm.png 480w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-151057-md.png 768w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-151057-xl.png 1024w"><figcaption>Editor view of creating a variable with the type "SceneData"</figcaption></figure><figure class="post__image post__image--center"><img loading="lazy" src="https://broremilolofsson.github.io/media/posts/4/Skaermbild-2024-04-02-151026.png" height="242" width="311" alt="" sizes="(min-width: 760px) 660px, calc(93.18vw - 30px)" srcset="https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-151026-xs.png 320w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-151026-sm.png 480w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-151026-md.png 768w, https://broremilolofsson.github.io/media/posts/4/responsive/Skaermbild-2024-04-02-151026-xl.png 1024w"><figcaption>Setter and getter for the variable "MySceneData"</figcaption></figure><h3 id="improvements">Improvements</h3><p>The are a lot of things that can be improved with the system. This includes:</p><ul><li>Allowing references as inputs to the node functions</li><li>Enabling default values as inputs</li><li>A lot of needed functionality for editor purposes, such as copying of nodes.</li></ul></div></div></article></main><div class="right-bar"><div class="right-bar__inner"><div class="sidebar"><div class="box follow"><a href="https://www.linkedin.com/in/emil-olofsson-0981162ba/" class="tltp tltp--top" aria-label="LinkedIn"><svg><use xlink:href="https://broremilolofsson.github.io/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span></a></div></div></div></div></div><script defer="defer" src="https://broremilolofsson.github.io/assets/js/scripts.min.js?v=12d8fcd46db8fdc7af6797ec26849875"></script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>